I"ä<h1 id="kubespray">kubespray</h1>

<p><a href="https://github.com/kubernetes-sigs/kubespray">Resmi Sitesi</a></p>

<p>Kubespray kubernetes kurulum ve bakÄ±mlarÄ±nÄ± otomatikleÅŸtiren, ansible Ã¼zerine geliÅŸtirilmiÅŸ, resmi bir araÃ§tÄ±r.</p>

<p>SaÄŸladÄ±klarÄ±:</p>

<ul>
  <li>Otomasyon</li>
  <li>HA:  https://github.com/kubernetes-sigs/kubespray/blob/master/docs/ha-mode.md</li>
  <li>node ekleme ve Ã§Ä±karma, gÃ¼ncelleme</li>
  <li>Eklenti ekleme, Ã§Ä±karma</li>
</ul>

<h2 id="kurulum">Kurulum</h2>

<pre><code class="language-mermaid">graph TD
A(Ansible Controller)  --&gt; B(Master &amp; Etcd)
A(Ansible Controller)  --&gt; C(Master &amp; Etcd)
A(Ansible Controller)  --&gt; D(Master &amp; Etcd)
A(Ansible Controller)  ---&gt; E(Worker)
A(Ansible Controller)  ---&gt; F(..)
A(Ansible Controller)  ---&gt; G(Worker)
</code></pre>
<pre><code class="language-mermaid">
graph TD
A(Ansible Controller)  --&gt; B[Etcd]
A(Ansible Controller)  --&gt; C[Etcd]
A(Ansible Controller)  --&gt; D(Etcd)
A(Ansible Controller)  ---&gt; E(Master)
A(Ansible Controller)  ---&gt; F(Master)
A(Ansible Controller)  ---&gt; G(Master)
A(Ansible Controller)  ----&gt; H(Worker)
A(Ansible Controller)  ----&gt; J(..)
A(Ansible Controller)  ----&gt; K(Worker)

</code></pre>

<hr />

<h2 id="desktop-ortama-kurmak-bonus">Desktop Ortama Kurmak (Bonus)</h2>

<p>Kendi ortamÄ±mÄ±zda test etmek istiyorsak <a href="vagrant.md">vagrant</a> dosyasÄ±ndaki vagrant ve virtualbox araÃ§larÄ±yla hÄ±zlÄ±ca deneyebiliriz.</p>

<hr />

<ul>
  <li>Ansible kontrol makinasÄ± WSL ya da bir linux makinasÄ± olmak zorundadÄ±r.</li>
  <li>Sunucular arasÄ±ndaki eriÅŸimler iÃ§in <a href="https://kubernetes.io/docs/reference/ports-and-protocols/">buraya</a> uyulmak zorundadÄ±r.</li>
</ul>

<p>Kontrol makinasÄ±nda pip3â€™Ã¼n kurulu olmasÄ± gerekir.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">requirements.txt</code>ye gÃ¶re gerekenleri kurun.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo pip3 install -r requirements.txt
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">inventory/sample</code> hazÄ±r ÅŸablonunu <code class="language-plaintext highlighter-rouge">inventory/mycluster</code> olarak kopyala</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp -rfp inventory/sample inventory/mycluster
</code></pre></div></div>

<ul>
  <li>Kubernetes kuracaÄŸÄ±nÄ±z sunucularÄ±n listesini Ansibleâ€™a veriyoruz.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>declare -a IPS=(&lt;server1_ip&gt; &lt;server2_ip&gt; &lt;server3_ip&gt;)
CONFIG_FILE=inventory/mycluster/hosts.yaml python3 contrib/inventory_builder/inventory.py ${IPS[@]}

</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">inventory/mycluster/group_vars</code> klasÃ¶rÃ¼ altÄ±ndaki bu dosyalarÄ± gÃ¶zden geÃ§irin, deÄŸiÅŸtirmek istediklerinizi deÄŸiÅŸtirin.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat inventory/mycluster/group_vars/all/all.yml
cat inventory/mycluster/group_vars/k8s_cluster/k8s-cluster.yml
</code></pre></div></div>

<ul>
  <li>Ansible ile Kubesprayâ€™i Ã§alÄ±ÅŸtÄ±rÄ±n ve Kubernetes kÃ¼menizi kurun. Burada sudo yetkisine sahip bir kullanÄ±cÄ± gerekmektedir. EÄŸer sunuculara parola ile eriÅŸiyorsanÄ±z <code class="language-plaintext highlighter-rouge">-kK</code> size eriÅŸim parolasÄ± ve sudo parolasÄ±nÄ± soracaktÄ±r.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook -i inventory/mycluster/hosts.yaml  --become --become-user=root cluster.yml
ansible-playbook -i inventory/mycluster/hosts.yaml -b cluster.yml -u &lt;kullanÄ±cÄ±&gt; -kK
</code></pre></div></div>
<ul>
  <li>Eksik bir ÅŸey yoksa yukarÄ±daki IPS tanÄ±mÄ±nda verilen sunuculara kubernetes kÃ¼mesi kurulacaktÄ±r.</li>
</ul>

<h2 id="yeni-nod-ekleme">Yeni nod ekleme</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>declare -a IPS=(&lt;server1_ip&gt; &lt;server2_ip&gt; &lt;server3_ip&gt; &lt;yeni_nod_ip&gt;)
CONFIG_FILE=inventory/mycluster/hosts.yaml python3 contrib/inventory_builder/inventory.py ${IPS[@]}

ansible-playbook -i inventory/mycluster/hosts.yaml -b cluster.yml -u &lt;kullanÄ±cÄ±&gt; -kK --limit=kube_control_plane
</code></pre></div></div>
<h2 id="dashboard-ve-yeni-eklenti-kurma"><a href="dashboard.md">Dashboard ve yeni eklenti kurma</a></h2>

<ul>
  <li>Kaynaklar
<a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/nodes.md">Node Ekleme, DeÄŸiÅŸtirme</a></li>
</ul>
:ET