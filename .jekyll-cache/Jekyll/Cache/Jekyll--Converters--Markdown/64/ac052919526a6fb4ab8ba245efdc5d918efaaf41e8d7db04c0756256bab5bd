I"Ÿ<<h1 id="configmap">configmap</h1>

<p><strong>ConfigMap</strong>, uygulamanÄ±zÄ±n yapÄ±landÄ±rmasÄ±nÄ± harici hale getirmenize izin veren Kubernetes kaynaÄŸÄ±dÄ±r.</p>

<ul>
  <li>https://12factor.net/config</li>
</ul>

<p>UygulamayÄ± ve servisi kuralÄ±m</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/redhat-scholars/kubernetes-tutorial/master/apps/kubefiles/myboot-deployment.yml

kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/redhat-scholars/kubernetes-tutorial/master/apps/kubefiles/myboot-service.yml
</code></pre></div></div>

<p>configure tanÄ±mÄ±na bakalÄ±m</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nv">$IP</span>:<span class="nv">$PORT</span>/configure

</code></pre></div></div>

<p>Ã§evresel deÄŸiÅŸkenleri elle girelim (amele yÃ¶ntem)</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nb">set env </span>deployment/myboot <span class="nv">GREETING</span><span class="o">=</span><span class="s2">"namaste"</span>
kubectl <span class="nb">set env </span>deployment/myboot <span class="nv">LOVE</span><span class="o">=</span><span class="s2">"Aloha"</span>
kubectl <span class="nb">set env </span>deployment/myboot <span class="nv">DBCONN</span><span class="o">=</span><span class="s2">"jdbc:sqlserver://45.91.12.123:1443;user=MyUserName;password=*****;"</span>

<span class="c"># podlar yeni Ã§dleri almak iÃ§in yeniden oluÅŸacaklardÄ±r.</span>

NAME                      READY   STATUS        RESTARTS   AGE
myboot-66d7d57687-jsbz7   1/1     Terminating   0          5m
myboot-785ff6bddc-ghwpc   1/1     Running       0          13s
</code></pre></div></div>
<p>yeni Ã§dleri gÃ¶rebiliriz.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl describe deployment myboot

...
  Containers:
   myboot:
    Image:      quay.io/burrsutter/myboot:v1
    Port:       8080/TCP
    Host Port:  0/TCP
    Environment:
      GREETING:  namaste
      LOVE:      Aloha
      DBCONN:    jdbc:sqlserver://45.91.12.123:1443<span class="p">;</span><span class="nv">user</span><span class="o">=</span>MyUserName<span class="p">;</span><span class="nv">password</span><span class="o">=</span><span class="k">*****</span><span class="p">;</span>
    Mounts:      &lt;none&gt;
  Volumes:       &lt;none&gt;
...
</code></pre></div></div>

<p>Ã§dleri kaldÄ±ralÄ±m</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
kubectl <span class="nb">set env </span>deployment/myboot GREETING-
kubectl <span class="nb">set env </span>deployment/myboot LOVE-
kubectl <span class="nb">set env </span>deployment/myboot DBCONN-

</code></pre></div></div>
<p>curl ile bakalÄ±m</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nv">$IP</span>:<span class="nv">$PORT</span>/configure

Configuration <span class="k">for</span> : myboot-66d7d57687-xkgw6
<span class="nv">databaseConn</span><span class="o">=</span>Default
<span class="nv">msgBroker</span><span class="o">=</span>Default
<span class="nv">greeting</span><span class="o">=</span>Default
<span class="nv">love</span><span class="o">=</span>Default
</code></pre></div></div>

<h2 id="configmap-1">ConfigMap</h2>

<p>https://github.com/redhat-scholars/kubernetes-tutorial/blob/master/apps/config/some.properties</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create cm my-config <span class="nt">--from-env-file</span><span class="o">=</span>apps/config/some.properties

kubectl get cm
kubectl get cm my-config
kubectl get cm my-config <span class="nt">-o</span> json

...
    <span class="s2">"data"</span>: <span class="o">{</span>
        <span class="s2">"GREETING"</span>: <span class="s2">"jambo"</span>,
        <span class="s2">"LOVE"</span>: <span class="s2">"Amour"</span>
    <span class="o">}</span>,
    <span class="s2">"kind"</span>: <span class="s2">"ConfigMap"</span>,
...

kubectl describe cm my-config

Name:         my-config
Namespace:    myspace
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
<span class="o">====</span>
GREETING:
<span class="o">====</span>
jambo
LOVE:
<span class="o">====</span>
Amour
Events:  &lt;none&gt;
</code></pre></div></div>

<p>Bu configmapâ€™i kullanan uygulamayÄ± kuralÄ±m</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/redhat-scholars/kubernetes-tutorial/master/apps/kubefiles/myboot-deployment-configuration.yml
</code></pre></div></div>

<p>Ä°ÅŸe yaramÄ±ÅŸ mÄ±?</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nv">$IP</span>:<span class="nv">$PORT</span>/configure

Configuration <span class="k">for</span> : myboot-84bfcff474-x6xnt
<span class="nv">databaseConn</span><span class="o">=</span>Default
<span class="nv">msgBroker</span><span class="o">=</span>Default
<span class="nv">greeting</span><span class="o">=</span>jambo
<span class="nv">love</span><span class="o">=</span>Amour
</code></pre></div></div>

<p>BaÅŸka bir configmap oluÅŸturup ona geÃ§iyoruz</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
kubectl delete cm my-config
kubectl create cm my-config <span class="nt">--from-env-file</span><span class="o">=</span>apps/config/other.properties
kubectl delete pod <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>myboot

curl <span class="nv">$IP</span>:<span class="nv">$PORT</span>/configure


Configuration <span class="k">for</span> : myboot-694954fc6d-nzdvx
<span class="nv">databaseConn</span><span class="o">=</span>jdbc:sqlserver://123.123.123.123:1443<span class="p">;</span><span class="nv">user</span><span class="o">=</span>MyUserName<span class="p">;</span><span class="nv">password</span><span class="o">=</span><span class="k">*****</span><span class="p">;</span>
<span class="nv">msgBroker</span><span class="o">=</span>tcp://localhost:61616?jms.useAsyncSend<span class="o">=</span><span class="nb">true
</span><span class="nv">hello</span><span class="o">=</span>Default
<span class="nv">love</span><span class="o">=</span>Default

</code></pre></div></div>

<p>config map</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">game-demo</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="c1"># Ã¶zellik tipi anahtarlar; her anahtar bir deÄŸeri adresler</span>
  <span class="na">player_initial_lives</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>
  <span class="na">ui_properties_file_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">user-interface.properties"</span>
  <span class="c1">#</span>
  <span class="c1"># dosya tipi anahtarlar</span>
  <span class="na">game.properties</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">enemy.types=aliens,monsters</span>
    <span class="s">player.maximum-lives=5</span>
  <span class="na">user-interface.properties</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">color.good=purple</span>
    <span class="s">color.bad=yellow</span>
    <span class="s">allow.textmode=true</span>

</code></pre></div></div>

<p>deployment</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">configmap-demo-pod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">demo</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">game.example/demo-game</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="c1"># Bir ortam deÄŸiÅŸkeni tanÄ±mla</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">PLAYER_INITIAL_LIVES</span> <span class="c1"># burada isimlendirme bÃ¼yÃ¼k harf diÄŸerinden farklÄ±</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">configMapKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">game-demo</span>           <span class="c1"># configmap adÄ± </span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">player_initial_lives</span> <span class="c1"># deÄŸeri alacaÄŸÄ± anahtar</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">UI_PROPERTIES_FILE_NAME</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">configMapKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">game-demo</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">ui_properties_file_name</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
        <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/config"</span>
        <span class="na">readOnly</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="c1"># Ã–nce pod seviyesinde dizini tanÄ±mlÄ±yoruz ve yukarda container'Ä±n iÃ§ine baÄŸlÄ±yoruz. </span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
      <span class="na">configMap</span><span class="pi">:</span>
        <span class="c1"># BaÄŸlayacaÄŸÄ±nÄ±z configMap'in adÄ±</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">game-demo</span>
        <span class="c1"># Dosya olarak oluÅŸturacaÄŸÄ±mÄ±z ConfigMapteki anahtarlar dizini. </span>
        <span class="na">items</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">game.properties"</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">game.properties"</span>
        <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">user-interface.properties"</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">user-interface.properties"</span>

</code></pre></div></div>

<h2 id="configmapten-script-Ã§alÄ±ÅŸtÄ±rma">Configmapten script Ã§alÄ±ÅŸtÄ±rma</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello from the script baked into the container"</span>
<span class="nb">echo</span> <span class="s2">"Sleeping for eternity!"</span>
<span class="nb">sleep </span>infinity

</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create configmap cf-echoscript from-file run.sh
</code></pre></div></div>

<p>Deployment</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">echoscript</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">echoscript</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">echoscript</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">echoscript</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">echoscript</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">busybox</span>
        <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/bin/sh"</span><span class="pi">]</span>
        <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/scripts-dir/run.sh"</span><span class="pi">]</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">scripts-vol</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/scripts-dir</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">scripts-vol</span>
        <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">cf-echoscript</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> echoscript-deployment.yaml
</code></pre></div></div>

<p>Referans
https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/</p>

<p>Temizlik</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete deployment myboot
kubectl delete cm my-config
kubectl delete service myboot
</code></pre></div></div>
:ET